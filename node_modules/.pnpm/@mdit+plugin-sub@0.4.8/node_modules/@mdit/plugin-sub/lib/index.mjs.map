{"version":3,"file":"index.mjs","sources":["../src/utils.ts","../src/plugin.ts"],"sourcesContent":["export const UNESCAPE_RE = /\\\\([ \\\\!\"#$%&'()*+,./:;<=>?@[\\]^_`{|}~-])/gu;\n","/**\n * Forked from https://github.com/markdown-it/markdown-it-sub/blob/master/index.js\n */\n\nimport { type PluginSimple } from \"markdown-it\";\nimport { type RuleInline } from \"markdown-it/lib/parser_inline.js\";\n\nimport { UNESCAPE_RE } from \"./utils.js\";\n\nconst subscriptRender: RuleInline = (state, silent) => {\n  let found;\n  let token;\n  const max = state.posMax;\n  const start = state.pos;\n\n  if (state.src.charAt(start) !== \"~\") return false;\n\n  if (silent) return false; // don’t run any pairs in validation mode\n  if (start + 2 >= max) return false;\n\n  state.pos = start + 1;\n\n  while (state.pos < max) {\n    if (state.src.charAt(state.pos) === \"~\") {\n      found = true;\n      break;\n    }\n\n    state.md.inline.skipToken(state);\n  }\n\n  if (!found || start + 1 === state.pos) {\n    state.pos = start;\n\n    return false;\n  }\n\n  const content = state.src.slice(start + 1, state.pos);\n\n  // don’t allow unescaped spaces/newlines inside\n  if (/(^|[^\\\\])(\\\\\\\\)*\\s/u.exec(content)) {\n    state.pos = start;\n\n    return false;\n  }\n\n  // found!\n  state.posMax = state.pos;\n  state.pos = start + 1;\n\n  // Earlier we checked !silent, but this implementation does not need it\n  token = state.push(\"sub_open\", \"sub\", 1);\n  token.markup = \"~\";\n\n  token = state.push(\"text\", \"\", 0);\n  token.content = content.replace(UNESCAPE_RE, \"$1\");\n\n  token = state.push(\"sub_close\", \"sub\", -1);\n  token.markup = \"~\";\n\n  state.pos = state.posMax + 1;\n  state.posMax = max;\n\n  return true;\n};\n\nexport const sub: PluginSimple = (md) => {\n  md.inline.ruler.after(\"emphasis\", \"sub\", subscriptRender);\n};\n"],"names":["UNESCAPE_RE","subscriptRender","state","silent","found","token","max","start","content","sub","md"],"mappings":"AAAO,MAAMA,EAAc,8CCSrBC,EAA8B,CAACC,EAAOC,IAAW,CACrD,IAAIC,EACAC,EACJ,MAAMC,EAAMJ,EAAM,OACZK,EAAQL,EAAM,IAKpB,GAHIA,EAAM,IAAI,OAAOK,CAAK,IAAM,KAE5BJ,GACAI,EAAQ,GAAKD,EAAK,MAAO,GAI7B,IAFAJ,EAAM,IAAMK,EAAQ,EAEbL,EAAM,IAAMI,GAAK,CACtB,GAAIJ,EAAM,IAAI,OAAOA,EAAM,GAAG,IAAM,IAAK,CACvCE,EAAQ,GACR,MAGFF,EAAM,GAAG,OAAO,UAAUA,CAAK,EAGjC,GAAI,CAACE,GAASG,EAAQ,IAAML,EAAM,IAChC,OAAAA,EAAM,IAAMK,EAEL,GAGT,MAAMC,EAAUN,EAAM,IAAI,MAAMK,EAAQ,EAAGL,EAAM,GAAG,EAGpD,MAAI,sBAAsB,KAAKM,CAAO,GACpCN,EAAM,IAAMK,EAEL,KAITL,EAAM,OAASA,EAAM,IACrBA,EAAM,IAAMK,EAAQ,EAGpBF,EAAQH,EAAM,KAAK,WAAY,MAAO,CAAC,EACvCG,EAAM,OAAS,IAEfA,EAAQH,EAAM,KAAK,OAAQ,GAAI,CAAC,EAChCG,EAAM,QAAUG,EAAQ,QAAQR,EAAa,IAAI,EAEjDK,EAAQH,EAAM,KAAK,YAAa,MAAO,EAAE,EACzCG,EAAM,OAAS,IAEfH,EAAM,IAAMA,EAAM,OAAS,EAC3BA,EAAM,OAASI,EAER,GACT,EAEaG,EAAqBC,GAAO,CACvCA,EAAG,OAAO,MAAM,MAAM,WAAY,MAAOT,CAAe,CAC1D"}