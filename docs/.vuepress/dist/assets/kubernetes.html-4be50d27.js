import{_ as c,Z as i,$ as u,a0 as n,a1 as a,a2 as s,a3 as r,a4 as l,G as t}from"./framework-1b68163c.js";const d={},k=n("h1",{id:"kubernetes",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#kubernetes","aria-hidden":"true"},"#"),a(" Kubernetes")],-1),m={href:"https://kubernetes.io/",target:"_blank",rel:"noopener noreferrer"},v=n("h2",{id:"main-process",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#main-process","aria-hidden":"true"},"#"),a(" Main Process")],-1),b={href:"https://kubernetes.io/",target:"_blank",rel:"noopener noreferrer"},y=n("li",null,[a("Create Kubernetes resources including "),n("code",null,"Deployment"),a(", "),n("code",null,"Service"),a(", "),n("code",null,"PersistentVolumeClaim"),a(", etc.")],-1),h=n("li",null,"Start Crawlab.",-1),_=n("div",{class:"hint-container warning"},[n("p",{class:"hint-container-title"},"Note"),n("p",null,"Before following below guidance, we will assume you have installed Kubernetes and already created the Kubernetes cluster.")],-1),g=n("h2",{id:"multi-node-deployment",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#multi-node-deployment","aria-hidden":"true"},"#"),a(" Multi-Node Deployment")],-1),w=n("p",null,"Kubernetes is designed for large-scale deployment, and it is easy to scale Crawlab to multiple nodes. In the diagram below, we have a Master Node and three Worker Nodes. The Master Node is connected to a MongoDB instance.",-1),f=l(`<h3 id="master-node-persistentvolumeclaim-pvc" tabindex="-1"><a class="header-anchor" href="#master-node-persistentvolumeclaim-pvc" aria-hidden="true">#</a> Master Node PersistentVolumeClaim (PVC)</h3><p>In Kubernetes, you need to create <code>PersistentVolume</code> and <code>PersistentVolumeClaim</code> to store Crawlab nodes data. Below is an example for Master Node.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>pvc
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> crawlab
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The above <code>PersistentVolumeClaim</code> requests 10Gi storage for the Master Node. Normally you only need to create <code>PersistentVolumeClaim</code> for Master Node only, because Worker Nodes can be scaled up and down at any time.</p><h3 id="master-node-deployment" tabindex="-1"><a class="header-anchor" href="#master-node-deployment" aria-hidden="true">#</a> Master Node Deployment</h3><p>Below is an example of <code>Deployment</code> for Master Node. Here we assume you are connecting to an external MongoDB instance.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> crawlab
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>storage
          <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
            <span class="token key atrule">claimName</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>pvc
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> master
          <span class="token key atrule">image</span><span class="token punctuation">:</span> crawlabteam/crawlab<span class="token punctuation">:</span>latest
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_NODE_MASTER
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;Y&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_URI
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_uri&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_HOST
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_host&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_PORT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_port&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_DB
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_db&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_USERNAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_username&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_PASSWORD
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_password&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_AUTHSOURCE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_auth_source&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_AUTHMECHANISM
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_auth_mechanism&gt;&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_MONGO_AUTHMECHANISMPROPERTIES
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;mongo_auth_mechanism_properties&gt;&#39;</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>storage
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/.crawlab
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>storage
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>storage
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/crawlab
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="master-node-service" tabindex="-1"><a class="header-anchor" href="#master-node-service" aria-hidden="true">#</a> Master Node Service</h3><p>The Master Node Service is used to expose the API and GRPC ports to the both internal and external environments. This is essential for Worker Nodes to connect to the Master Node. Also, it is necessary for the Crawlab Web UI to connect to the Master Node, so that you can visit the Crawlab Web UI from your browser.</p><p>Below is an example of <code>Service</code> for Master Node.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> crawlab
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> api
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> grpc
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9666</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9666</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),N={class:"hint-container tip"},A=n("p",{class:"hint-container-title"},"Tips",-1),C=n("code",null,"Service",-1),M=n("code",null,"ClusterIP",-1),R=n("code",null,"NodePort",-1),x=n("code",null,"LoadBalancer",-1),O={href:"https://kubernetes.io/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"},W=l(`<p>After creating the <code>Service</code>, you can access Crawlab Web UI by visiting <code>http://&lt;service_ip&gt;:8080</code> in your browser.</p><h3 id="worker-node-deployment" tabindex="-1"><a class="header-anchor" href="#worker-node-deployment" aria-hidden="true">#</a> Worker Node Deployment</h3><p>The <code>Deployment</code> for Worker Node is similar to the Master Node. The only difference is that you need to set <code>CRAWLAB_NODE_MASTER</code> to <code>N</code> and <code>CRAWLAB_GRPC_ADDRESS</code> to the Master Node Service address, which in this case is <code>crawlab-master-service:9666</code>.</p><p>Below is an example of <code>Deployment</code> for Worker Node.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>worker
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> crawlab
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>worker
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> crawlab<span class="token punctuation">-</span>worker
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> worker
          <span class="token key atrule">image</span><span class="token punctuation">:</span> crawlabteam/crawlab<span class="token punctuation">:</span>latest
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_NODE_MASTER
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;N&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_GRPC_ADDRESS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;crawlab-master-service:9666&#39;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CRAWLAB_FS_FILER_URL
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;http://crawlab-master-service:8080/api/filer&#39;</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the above example, we will create 3 Worker Nodes. You can scale up or down the Worker Nodes by changing the <code>replicas</code> field.</p>`,6);function B(D,S){const e=t("ExternalLinkIcon"),o=t("RouterLink"),p=t("Mermaid");return i(),u("div",null,[k,n("p",null,[n("a",m,[a("Kubernetes"),s(e)]),a(" is an open-source container orchestration platform that automates the deployment, scaling, and management of containerized applications. It is widely used in the industry and has a large community. If you are going to deploy a large-scale Crawlab cluster, Kubernetes is a good choice.")]),v,n("p",null,[a("If you are familiar with Crawlab "),s(o,{to:"/en/guide/installation/docker.html"},{default:r(()=>[a("Docker installation")]),_:1}),a(", you will find that the main process of Kubernetes installation is similar. The only difference is that you need to create Kubernetes resources instead of Docker containers.")]),n("ol",null,[n("li",null,[a("Install "),n("a",b,[a("Kubernetes"),s(e)]),a(".")]),y,h]),_,g,w,s(p,{id:"mermaid-40",code:"eJyNzsELgjAUx/F7f8WDrnlwiwqJDuIxO0TQQTzM+dTR9MmciP99WiMQgrr+vp+xV2gaZCWMhfN1BdD1WWlEW0Hca6u8C+UIEbaaxhobOwGAXBmUVlEDt/A11EksOosGZp3C0fNOMPjJnczDjeCnb+kiW0S2jHwRuYtlElNTUhS6D+ppxiafT7ajxul1obQO1tvswDO2kaTJBEOlLH7I4DuDO8G4/G7YH4b/NnXpzG4vGRcL8wR5BXQH"}),f,n("div",N,[A,n("p",null,[a("Normally a "),C,a(" has a "),M,a(" type, which means it is only accessible within the Kubernetes cluster. If you want to expose the Master Node to the external environment, you can use "),R,a(" or "),x,a(" type. For more information, please refer to the "),n("a",O,[a("Kubernetes Service"),s(e)]),a(".")])]),W])}const L=c(d,[["render",B],["__file","kubernetes.html.vue"]]);export{L as default};
